---
title: 第6章 应用层
tags: []
id: '826'
categories:
  - - 研
comments: false
---

# 第六章 应用层

#计算机网络

对应用程序的通信提供服务

应用层协议定义：

*   应用进程交换的报文类型，请求还是响应？
*   各种报文类型的语法，如报文中的各个字段及其详细描述
*   字段的语义，即包含在字段中的信息的含义
*   进程何时、如何发送报文，以及对报文进行响应的规则

应用层功能：

1.  文件传输、访问和管理
2.  电子邮件
3.  虚拟终端
4.  查询服务和远程作业登录

重要协议：FTP、SMTP、POP3、HTTP、DNS

## 网络应用模型

### 客户/服务器模型

服务器：**提供计算服务**的设备

1.  永久提供服务
2.  永久性访问地址/域名

客户机：**请求计算服务**的主机

1.  与服务器通信，使用服务器提供的服务
2.  间歇性接入网络
3.  可能使用动态IP地址
4.  不与其他客户机直接通信

应用：Web,文件传输FTP,远程登录，电子邮件

### P2P模型

特点：

*   不存在永远在线的服务器
*   每个主机既可以**提供服务**，也可以**请求服务**
*   任意端系统/节点之间可以**直接通讯**
*   节点间歇性接入网络
*   节点可能改变IP地址
*   可扩展性好
*   网络健壮性强

## 域名系统DNS

DNS在\[\[第5章 传输层传输层\]\]采用无连接的\[\[第5章 传输层#UDP协议UDP\]\]服务

### 层次域名空间

```tree
└─根 .
  ├─顶级域名
    ├─国家顶级域名cn,us,uk
    ├─通用顶级域名com,net,org,gov,int,aero,museum,travel
    └─基础结构域名/反向域名arpa（从IP到域名）
  ├─二级域名
    ├─类别域名ac,com,edu,gov,mil,net,org
    └─行政区域名用于我国各省、自治区、直辖市bjjs
  ├─三级域名
  └─四级域名
```

!\[\[域名.png\]\]

### 域名服务器

1.  根域名服务器
    *   因特网上有13个根渔民服务器（从a.rootservers.net~m.rootservers.net）
2.  顶级域名服务器
3.  授权（权限）域名服务器
4.  本地域名服务器

域名服务器层次

*   根域名服务器
*   顶级域名服务器
*   授权（权限）域名服务器

> 本地域名服务器不属于应服务器层次

### 域名解析过程

递归查询、迭代查询： !\[\[递归查询、迭代查询.png\]\]

## 文件传输协议FTP

基于\[\[第5章 传输层#TCP协议TCP\]\]，提供不同种类主机系统（硬、软件体系等都可以不同）之间的文件传输能力 FTP传输控制信息使用的是数据连接外的控制连接，\*\*==即FTP的控制信息是外带传送的==\*\* FTP并`不`适合两个计算机之间==共享读写文件== FTP提供交互式访问，允许客户指明文件的类型与格式，并允许文件具有存取权限

文件传输协议：

*   文件传输协议FTP=>基于TCP
*   简单文件传输协议TFTP=>基于UDP

FTP是基于客户/服务器(C/S)的协议 用户通过一个客户机程序连接至在远程计算机上运行的服务器程序 依照FTP协议提供服务，进行文件传送的计算机就是FTP服务器 连接FTP服务器，遵循FTP协议与服务器传送文件的电脑就是FTP客户端

### 工作原理

*   登陆：ftp地址、用户名&密码
    *   匿名登录：互连网中有很大一部分FTP服务器被称为“匿名”（Anonymous）FTP服务器。这类服务器的目的是向公众提供文件拷贝服务，不要求用户事先在该服务器进行登记注册，也不用取得FTP服务器的授权。Anonymous（匿名文件传输）能够使用户与远程主机建立连接并以匿名身份从远程主机上拷贝文件，而不必是该远程主机的注册用户。用户使用特殊的用户名“anonymous”登录FTP服务，就可访问远程主机上公开的文件
*   传输：==控制连接始终保持==、==数据连接保持一会（传输完毕数据就关闭）==
    *   !\[\[FTP工作原理.png\]\]

\==是否使用TCP20端口建立数据连接与传输模式有关==

*   主动方式使用TCP20端口
*   被动方式由服务器和客户端自行协商决定（端口>1024）

### FTP传输模式

*   文本模式：ASCI模式，以文本序列传输数据
*   二进制模式：Binary模式，以二进制序列传输数据

## 电子邮件

### 概述

#### 信息格式

```
└─电子邮件
  ├─信封：xxxx@xxxx.xxx
  └─内容
     ├─首部（from、to、主题、时间等）
     └─主体（信件内容）
```

#### 组成结构

*   用户代理
    *   功能：
        1.  撰写
        2.  显示
        3.  处理
        4.  通信
*   邮件服务器
    *   C/S
    *   功能：
        1.  发送&接收邮件
        2.  向发件人报告邮件传送结果
*   协议

电子邮件系统组成结构： !\[\[电子邮件系统组成结构.png\]\]

### 协议

#### SMTP

基于\[\[第5章 传输层#TCP协议TCP\]\]，端口号25，采用C/S模式，==发送邮件中所使用的协议==

SMTP规定了在两个相互通信的SMTP进程之间应如何交换信息。 负责发送邮件的SMTP进程就是SMTP客户，负责接收邮件的进程就是SMTP服务器。 SMTP规定了14条命令（几个字母）和21种应答信息（三位数字代码+简单文字说明）。

SMTP通信的三个阶段：

1.  `连接建立`
    *   SMTP客户端（两个邮件服务器通信过程时为发起连接的为客户端）跟SMTP服务器端建立TCP连接
    *   SMTP服务器端返回给SMTP客户端返回220 Service ready表示可以接收邮件
    *   SMTP客户端发送一个HELLO命令，等待SMTP服务器端返回
        *   若服务器端有能力接收邮件，返回“250 OK”即可继续
        *   否则返回“421 Service not available”
2.  `邮件传送`
    *   SMTP客户端发送一个MAIL命令
    *   SMTP服务器端若准备好，就返回“250 OK”，否则返回数字加英文信息，如451等（判断SMTP服务器是否已经准备好接收邮件）
    *   SMTP客户端发送一个或多个RCPT命令（收件人命令）
    *   SMTP服务器端对应每一个RCPT返回信息
        *   用户存在返回“250 OK”
        *   用户不存在返回“550 No such user here”
    *   SMTP服务器返回“250 OK”后SMTP客户端发送一个DATA命令（声明开始传输数据）
    *   SMTP服务器返回“354 start mail input;end with<CR><LF>.<CR><LF>”SMTP服务器同意传输
    *   SMTP客户端开始传输文件
    *   SMTP服务器接收完成返回“250 OK”
3.  `连接释放`
    *   邮件发完，SMTP客户发送QUIT命令，SMTP服务器返回“221”，表示同意释放TCP连接

SMTP的缺点：

1.  SMTP不能传送可执行文件或者其他二进制对象。
2.  SMTP仅限于传送7位ASCI码，不能传送其他非英语国家的文字。
3.  SMTP服务器会拒绝超过一定长度的邮件。

> SMTP的缺点的解决方案——\[\[第6章 应用层#MIMEMIME\]\]

#### POP3

基于\[\[第5章 传输层#TCP协议TCP\]\]，端口号25，采用C/S模式，==读取邮件中所使用的协议== POP3协议在传输层是使用明文传输密码的，并不对密码进行加密

POP3的工作方式：

1.  下载并保留（在服务器处保留）
2.  下载并删除（在服务器处删除）

#### IMAP

网际报文存取协议IMAP——==读取邮件中所使用的协议== IMAP协议比POP协议复杂。当用户Pc上的IMAP客户程序打开MAP服务器的邮箱时，用户可以看到邮箱的首部，若用户需要打开某个邮件，该邮件才上传到用户的计算机上 MAP可以让用户在不同的地方使用不同的计算机随时上网阅读处理邮件，还允许只读取邮件中的某一个部分(先看正文，有WiFi的时候再下载附件)

#### MIME

使电子邮件系统可以支持声音、图像、视频、多种国家语言等等 使得传输内容丰富多彩 !\[\[MIME.png\]\]

### 基于万维网的电子邮件

最大特点：方便

!\[\[基于万维网的电子邮件.png\]\]

## 万维网WWW

万维网WWW(World Wide Web)是一个大规模的、联机式的信息储藏所/资料空间，是无数个网络站点和网页的集合 资源：文字、视频、音频 ==统一资源定位符URL==唯一表示资源 URL的一般形式：<协议>://<主机>:<端口>/<路径> 万维网以==客户/服务器==方式工作，用户使用的浏览器就是万维网客户程序，万维网文档所驻留的主机运行服务器程序 万维网使用超文本标记语言==HTML==,使得万维网页面设计者可以很方便地从一个界面的链接转到另一个界面，并能够在自己的屏幕上显示出来

### 超文本传输协议HTTP

HTTP协议定义了浏览器（万维网客户进程）怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器

!\[\[超文本传输协议.png\]\]

#### HTTP传输的具体过程

1.  浏览器分析URL
2.  浏览器向DNS请求解析IP地址
3.  DNS解析出IP地址
4.  浏览器与服务器建立TCP连接
5.  浏览器发出取文件命令
6.  服务器响应
7.  释放TCP连接
8.  浏览器显示

#### HTTP协议的特点

*   HTTP协议是无状态的
    *   万维网站点可以使用Cookie（Cookie是存储在用户主机中的文本文件，记录一段时间内某用户的访问记录以提供个性化服务）识别用户
*   HTTP采用\[\[第5章 传输层#TCP协议TCP\]\]作为运输层协议，但==HTTP协议本身是无连接==的（通信双方在交换HTTP报文之前不需要先建立HTTP连接）

#### HTTP的连接方式

1.  持久连接——`Keep-alive`
    
    *   HTTP1.1支持!\[\[持久连接.png\]\]
    
    1.  非流水线
    2.  流水线（HTTP1.1默认）
2.  非持久连接——`Close`
    *   !\[\[非持久连接.png\]\]

#### HTTP报文结构

HTTP报文是==面向文本==的，因此在报文中的每一个字段都是一些ASCII码串

HTTP报文：HTTP请求报文、HTTP响应报文 !\[\[HTTP报文.png\]\]

*   开始行：用于区分是请求报文还是响应报文。在请求报文中的开始行称为请求行，而在响应报文中的开始行称为状态行
*   首部行：说明浏览器、服务器和报文主体的一些信息
*   实体主题：在请求报文中一般不用这个字段，而在响应报文中也可能没有这个字段

状态码：

*   1xx表示通知信息的，如请求收到了或正在处理
*   2xx表示成功，如接受或知道了
*   3xx表示重定向，如要完成请求还必须采取进一步的行动
*   4xx表示客户的差错，如请求中有错误的语法或不能完成
*   5xx表示服务器的差错，如服务器失效无法完成请求

HTTP请求报文中常用的几个方法：

方法（操作）

意义

GET

请求读取由URL标识的信息

HEAD

请求读取由URL标识的信息的首部

POST

给服务器添加信息（如注释）

CONNECT

用于代理服务器

# 应用层常用协议

应用程序

FTP数据连接

FTP控制连接

TELNET

SMTP

DNS

TFTP

HTTP

POP3

SNMP

使用协议

TCP

TCP

TCP

TCP

UDP

UDP

TCP

TCP

UDP

熟知端口号

20

21

23

25

53

69

80

110

161