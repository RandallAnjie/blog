---
title: 第3章 数据链路层
tags: []
id: '820'
categories:
  - - 研
comments: false
---

# 第三章 数据链路层

#计算机网络

## 名词解释

1.  结点：主机、路由器
2.  链路：网络中两个节点之间的物理通道，**传输介质有双绞线、光纤和微波**，分为有线链路和无线链路
3.  数据链路：网络中两个结点的逻辑通道，把实现控制传输协议的硬件和软件加在链路上就构成了数据链路
4.  帧：链路层协议数据单元，封装网络层数据报
5.  MTU：最大传送送单元。指的是帧数据部分的上限 ^ed55c4

## 数据链路层的功能

负责通过一条链路，从一个结点向另一个物理链路直接相连的相邻结点传送数据报

1.  为网络层提供服务
    1.  无确认、无连接服务（实时通信、误码率较低的通信信道。_如：以太网_）
    2.  有确认无连接的服务（误码率较高的通信信道。_如：无线通信_）
    3.  有确认面向连接的服务（通信实时性、可靠性较高的场合）
        
        > 有连接就一定有确认
        
2.  链路管理：连接的建立维持和释放
3.  组帧：帧定界、帧同步和透明传输 透明传输：不管传送的数据是怎样的比特组合都能在链路上传输
4.  流量控制
5.  差错控制：帧错/位错

## 组帧的方式（常用比特填充法和违规编码法）

1.  字符计数法 在帧头部使用一个计数字段来标明帧内字符数（包括自己本身） ![字符计数法.png](%E5%AD%97%E7%AC%A6%E8%AE%A1%E6%95%B0%E6%B3%95.png)
    
2.  字符填充法 用特定的字符来定界帧的开始与结束，若信息中出现特殊字符则在特殊字符前填充一个转义字符（ESC来区分） SOH：Start Of Header EOT：End Of Transmission ![字节填充法.png](%E5%AD%97%E8%8A%82%E5%A1%AB%E5%85%85%E6%B3%95.png)
    
3.  零比特填充法 用01111110来标志帧的开始与结束。发送方如果在信息中碰到连续的5个1时自动在后面插入一个0，接收方在信息中每收到5个连续的1自动删除后面紧跟着的0
    
    > 零比特填充法比字符填充法更易于用硬件实现，固性能更优
    
4.  违规编码法（IEEE802采用此种组帧方式） 如曼彻斯特编码就是将1编码为前高后低，将0编码为前低后高，则使用前高后高和前低后低用来帧定界
    

## 差错控制（检错/纠错）（比特错）

差错由噪声引起 噪声的性质

1.  全局性：线路的电器特性差生，随机噪声
2.  局部性：外界冲击噪声

```tree
└─差错
   ├─位错
   └─帧错
      ├─丢失
      ├─重复
      └─失序
```

> **在物理层中：编码仅针对单个比特，解决比特在传输中的同步问题** **在数据链路层中：编码针对一组比特检验差错**

1.  检错编码
    1.  奇偶校验码（及n-1位信息元与1位校验元组成奇/偶个1）（**只能检验出奇数个错误**）
    2.  循环冗余码（CRC）（r位的FCS（帧检验序列）=>r+1位的多项式）
        
        > 模二除法：同0亦1 r位的FCS<=>r+1位的多项式<=>多项式阶数为r<=>多项式为aXr+bXr-1+...+yX+zX0（共r+1位）（a~z为r+1位）
        

计算循环冗余码：（硬件实现） ![循环冗余码计算.png](%E5%BE%AA%E7%8E%AF%E5%86%97%E4%BD%99%E7%A0%81%E8%AE%A1%E7%AE%97.png)

接收端将接受到的数据除以r+1位的多项式，余数为0则接受，否则丢弃。

> ATT：数据链路层对于帧的无差错接受是**非可靠传输**，因为有传输错误的帧被丢弃了 def.**可靠传输：发送端发送的数据=接收端接收的数据**

2.  纠错编码（海明码）

> 海明距离：两个合法编码（码字）的对应比特取值不同的比特数，称这两个码字的海明距离（码距），一个编码集中，任意两个合法编码（码字）的海明距离称为该码集的海明距离（码距） 如果要检测出n位错误，码距最少为n+1；若要纠正n位置错误，码距最少为2n+1 两个编码之间的码距为不同字符的位数，编码集中码距表示任意两个码距的最小值

eg. 100和111之间码距为1；000，001，010，011，100，101，110，111之间码距为1

*   以1100为例

1.  确定海明码的位数（数据n位，校验码k位（校验码有2k种取值））
    
    > 海明不等式：n+k≤2k\-1
    
2.  确定校验位的分布
    
    > 规定校验位Pi在海明位号为2i-1的位置上 左边为高位，数据从高位填起
    

序号

7

6

5

4

3

2

1

序号对应二进制

111

110

101

100

011

010

001

值

1

1

0

x4

0

x2

x1

3.  分组以形成校验关系 根据序号对应二进制可以看出对
    
    *   x4校验码负责4、5、6、7的校验
    *   x2校验码负责2、3、6、7的校验
    *   x1校验码负责1、3、5、7的校验
        
        > 分组内通常采用偶校验
        
4.  校验位取值 偶校验即x4\=0；x2\=0；x1\=1 即完整海明码：1100001
    

序号

7

6

5

4

3

2

1

序号对应二进制

111

110

101

100

011

010

001

值

1

1

0

0

0

0

1

5.  海明码校验原理 计算校验方法：
    1.  手算校验码，若出错找差并集
    2.  求满足： a⊕x4⊕x5⊕x6⊕x7\=0 b⊕x2⊕x3⊕x6⊕x7\=0 c⊕x1⊕x3⊕x5⊕x7\=0 的a、b、c，则abc对应的十进制即为出错位；abc为000则未出错 （eg.收到的海明码为1110001；计算球得a=1，b=0，c=1，出错位为5）

## 流量控制与可靠传输机制

链路层流量控制手段：接收方收不下就不回复 传输层流量控制手段：接收方给发送方发送一个窗口公告 链路层的流量控制是点对点的（每两个相邻结点），传输层的流量控制是端到端的（数据的传输方和接收方）

发送窗口

接收窗口

问题

停止-等待协议

1

1

传输效率低

后退n帧协议（GBN）

\>1

1

选择重传协议（SR）

\>1

\>1

> 链路层的滑动窗口在传输过程中为固定值，网络层的滑动窗口在传输过程中会随之改变 滑动窗口协议中的计时器设定时间为重传时间，重传时间应该比平均RTT更长一些

```tree
└─滑动窗口解决
   ├─流量控制
   └─可靠传输（ARQ自动重传）
```

> 信道利用率：在一个发送周期内，有效地发送的数据的时间占总周期的比例 信道吞吐率：信道利用率\*发送方的发送速率

> 信道利用率=(L/c)/T（**信道利用率=发送方数据发送时间/发送方数据发送时间+RTT+发送方确认帧接受时间**）

L：T内发送L比特数据 c：发送方数据传输率 T：发送周期，从开始发送数据到收到第一个确认帧

**1\. 单帧滑动窗口与停止-等待协议（停止-等待协议相当于发送窗口和接收窗口大小均为1的滑动窗口协议）** 由于每发送一个数据帧就停止等待，因此用1bit来编号就已足够 1. 发送发送完数据帧时，必须在其发送缓存中保留此数据帧的副本 2. 数据帧和确认帧必须编号

停止-等待协议

优点

简单

缺点

信道利用率低

**2\. 多帧滑动窗口与后退N帧协议（GBN）**

*   ACKn表示对第n号帧的确认，表示接收方已正确接收到n号帧以及以前的所有帧（**累计确认**）
*   若用n比特对帧编号，则其发送窗口尺寸**WT应满足 1≤WT≤2n\-1**
*   接收方只接受接下来应该收到的一个帧（expectedseqnum），不是则会丢弃；出现超时，发送方发送所有已发送但是未被确认的帧
*   GBN协议必须相应的三件事：
    1.  上层的调用
    2.  收到一个ACK
    3.  超时事件

**3\. 多帧滑动窗口与选择重传协议（SR）**

*   选择重传协议的接受窗口WR尺寸和发送窗口WT尺寸都大于一
*   接收窗口WR+发送窗口WT小于等于2n
*   发送窗口最好等于接受窗口，大了会溢出，小了无意义
*   WTmax\=WRmax\=2n-1（n表示序号的比特数）
*   SR协议总结：
    1.  对数据帧逐一确认，收一个确认一个
    2.  只重传出错帧
    3.  接收方有缓存
    4.  WTmax\=WRmax\=2n-1（n表示序号的比特数）

## 介质访问控制（静态/动态划分信道）

```tree
└─传输数据的两种链路
   ├─点对点链路（广域网）
   │  └─ppp协议
   └─广播式链路（早期以太网、局域网）
      └─拓扑结构：逻辑上总线型，物理上总线型或星型
```

### 信道划分介质访问控制（实质上是把广播信号变为点对点信号）

> 静态划分信道

信道划分介质访问控制：将使用介质的每一个设备与来自同一信道上的其他通信设备隔离开，把时域、频域资源合理的分配给网络上的设备 介质访问控制：MAC（Multiple Access Control） 多路复用：结合两条或者多条线路传输，以充分利用信道

1.  频分多路复用（FDM）（F：frequency）**模拟信号** 类似”并行“ 优点：充分利用传输介质的带宽，系统效率较高，较容易实现 ![频分多路复用.png](%E9%A2%91%E5%88%86%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8.png)
2.  时分多路复用（TDM）（T：time）**数字信号** 类似”并发“ 统计时分多路复用（STDM）是TDM的一种改进，采用STDM帧，STDM帧并不固定分配时隙，而是动态分配时隙（时隙≤用户数量） ![时分多路复用.png](%E6%97%B6%E5%88%86%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8.png)

> 这里的TDM帧和STDM帧不是物理层的帧，是周期的标志

> TDM与FDM相比抗干扰能力强

3.  波分多路复用（WDM）（W:wave） 光（波）的频分多路复用
4.  码分多路复用（CDM）（C：code） 码分多址：CDMA **CDMA原理：**

> \==TODO:CDMA原理:page91==

### 随机访问介质访问控制

> 动态分配信道（动态媒体接入控制/多点接入）

1.  ALOHA协议（不听就说协议）
    
    1.  纯ALOHA协议（想发就发） 冲突检测：未收到确认帧 冲突处理：等待随机时间重传 纯ALOHA协议网络的 **吞吐量（一段时间内成功发送的平均帧数）** 很低 纯ALOHA协议最大网络吞吐量S为0.184
    2.  时隙ALOHA协议（控制了想法就发的随意性） 将各站在时间上同步起来，并且划分为一段段等长的时隙（Solt），只有在每个时隙开始才能发送一个帧
        
        > 关于ALOHA协议：
        > 
        > 1.  纯ALOHA协议比时隙ALOHA协议吞吐量更低，效率更低
        > 2.  纯ALOHA协议想发就发、时隙ALOHA协议只有在时间片段开始时才能发
        
2.  CSMA协议（先听再说协议） CSMA：载波监听多路访问 协议思想：发送数据帧之前监听信道
    
    1.  **1-坚持CSMA** 首先监听信道，如果空闲就立即发送数据，如果信道忙，就等待，同时继续监听直至信道空闲；如果**发送冲突**，那么随机等待一段时间后再重新开始侦听信道 优点：媒体利用率高 缺点：如果有2个或者多个站点再等待则必然发生冲突
    2.  **非坚持CSMA** 如果信道空闲则立即发送数据；如果信道忙，则放弃监听，等待一个随机的时间后再重复上述过程 优点：采用随机的重发延迟时间，减少冲突 缺点：可能降低媒体利用率
    3.  **p-坚持CSMA** 如果信道忙，就持续监听，直至信道空闲；如果信道空闲，则以概率p发送数据，以1-p的概率推迟到下一个时隙 优点：能减少冲突也能减少媒体空闲时间

信道状态

1-坚持CSMA

非坚持CSMA

p-坚持CSMA

空闲

立即发送数据

立即发送数据

以概率p发送数据，以概率1-p推迟到下一个时隙

忙

继续坚持侦听

放弃侦听，等待一个随机的时间后再侦听

持续侦听，直至信道空闲

> p-坚持CSMA协议适用于时隙信道。p-坚持中持续监听的意思是推迟到下一个时隙开始再监听

3.  CSMA/CD协议（先听再说，边听边说）**（总线型网络，半双工网络）** **CS**：载波监听 **MA**：多点接入 **CD**：碰撞检测、冲突检测 以太网端到端的往返时间2τ称为争用期（或冲突窗口、碰撞窗口） 帧的传输时延至少要两倍于信号在总线中的传播时延（防止发送完帧后才发现发生冲突）；即：**帧长/数据传输速率≥2τ**

> **最小帧长=总线传播时延\*数据传输速率\*2**

以太网最短帧长=64B ![传播时延对载波监听的影响.png](%E4%BC%A0%E6%92%AD%E6%97%B6%E5%BB%B6%E5%AF%B9%E8%BD%BD%E6%B3%A2%E7%9B%91%E5%90%AC%E7%9A%84%E5%BD%B1%E5%93%8D.png) CSMA/CD协议采用**二进制退避算法**解决碰撞问题： 1. 确定基本退避时间，一般取两倍总线端到端传输时延2τ（争用期） 2. 定义参数k，重传次数小于10时k等于重传次数，否则k=10，即k=min\[重传次数, 10\] 3. 从离散的整数集合\[0, 1,..., 2k\-1\]中随机取出一个整数r，重传所需的退避时间就是r倍的基本退避时间，即：2rτ 4. 重传达16次（**最大重传次数**）仍不能成功时，认为此帧永远无法正确发出，抛弃此帧并向上层报告

4.  CSMA/CA协议 **（无线局域网）** **CA**：碰撞避免
    1.  CSMA/CA协议的三个手段：
        1.  预约信道
        2.  ACK帧
        3.  RTS/CTS帧（可选）
    2.  IFS：帧间间隔。802.11规定所有站完成发送后，必须再等待一段很短的时间（继续监听）才能发送下一帧。802.11规定了3种IFS，从短到长依次是SIFS、PIFS、DIFS
    3.  CSMA/CA算法：
        1.  若站点最初有数据发送（非重传），且信道空闲，在等待时间DIFS后，发送整个数据帧
        2.  否则执行CSMA/CA退避算法，选取一个随机回退值（二进制退避算法）。一旦检测到信道忙，退避计时器保持不变。只要信道空闲，退避计时器就进行倒计时
        3.  当退避计时器减到0时（这时候信道只能是空闲的），站点就发送整个数据帧并等待确认
        4.  发送站若收到确认则已发送帧被目的站正确接收。如果发送第二帧就要从步骤2开始
    4.  处理隐蔽站问题：RTS和CTS 检测空闲，若空闲则发送一个RTS，接收端接受RTS并相应CTS，发送端收到CTS后开始发送数据帧（同时预约信道）接收方接收到数据，相应ACK，发送端未接收到ACK则采用二进制退避算法来确定重传时间

CSMA/CD协议

CSMA/CA协议

冲突

可以检测冲突，但是无法避免

发送数据的同时不能检测信道上有无冲突，本结点上没有冲突不意味接收结点没有冲突，只能尽量避免

传输介质

总线型以太网

无线局域网802.11a/b/h/n等

检测方式

通过电缆中的电压变化来检测

能量检测、载波检测和能量载波混合检测

基本思想

发前侦听，边发边听，一旦碰撞立马停止发送

发送数据前告知其他结点

### 轮询访问介质访问控制——令牌传递

> 动态分配信道（动态媒体接入控制/多点接入）

```tree
└─轮询访问MAC协议
   ├─轮询协议
   └─令牌传递协议
```

**令牌**是一个特殊的MAC控制帧，它本身不包含信息，仅控制信道的使用，确保同一时刻只有一个站点独占信道。应用于**令牌环网**（**物理上星型拓扑，逻辑上环形拓扑**）。适用于负载大通信量大的网络

轮询协议的问题：

1.  轮询开销
2.  等待开销
3.  单点故障

令牌传递协议的问题：

1.  令牌开销
2.  等待开销
3.  单点故障

## 局域网（广播信道）

局域网的**特点**：

1.  地理范围小
2.  传输速率高
3.  通信延迟时间短，误码率低
4.  各站平等关系，共享传输信道
5.  采用分布式控制和广播式通信，进行广播和组网

局域网的**拓扑结构**：

1.  星型拓扑
2.  总线型拓扑
3.  环型拓扑
4.  树型拓扑

局域网的**传输介质**：

1.  有线局域网：双绞线、同轴电缆、光纤
2.  无线局域网：电磁波

局域网的**介质访问控制**：

1.  CSMA/CD 总线型局域网、树型局域网
2.  令牌总线 总线型局域网、树型局域网
3.  令牌环 用于环形局域网

局域网的**分类**：

1.  以太网 逻辑：总线型；物理：星型；协议：CSMA/CD
2.  令牌环网 逻辑：环型；物理：星型
3.  FDDI 逻辑：环型；物理：双环型
4.  ATM 使用53字节进行交换
5.  无线区域网（WLAN） 采用IEEE802.11标准

### 以太网与IEEE802.3

以太网A.K.A.802.3局域网，采用CSMA/CD技术，特点：

1.  造价低廉
2.  应用广泛
3.  比令牌环网、ATM网便宜、简单
4.  满足网络速率要求

> IEEE802.3：以太网介质访问控制协议 IEEE802.5：令牌环网 IEEE802.8：光纤技术咨询组 IEEE802.11：无线局域网

以太网标准：1. DIX Ethernet V2标准 2. 802.3标准

以太网简化通讯的方式：

1.  采用无连接的工作方式，不对发送的数据帧编号，也不要求接收方发送确认
2.  发送的数据都使用曼彻斯特编码

#### 以太网的传输介质与网卡

网络适配器/网卡接口 介质访问控制（MAC）地址/硬件地址/物理地址

#### 以太网的MAC帧

![以太网帧结构.png](%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E7%BB%93%E6%9E%84.png)

> 其中类型2字节描述上层协议；46～1500来源是以太网最小帧长64B-首位18B=46B，以太网的MTU规定为1500；FCS检测帧采用CRC循环冗余码校验

#### 高速以太网（速率≥100MB/s）

1.  100BASE-T以太网 **全双工/半双工**
2.  吉比特以太网 **全双工/半双工** 光纤/双绞线
3.  10吉比特以太网 **全双工** 光纤

### IEEE802.11无线局域网

#### 无线局域网的组成（分类）

1.  有固定基础设施的无线局域网 中心成为接入点（AP，Access Point），在MAC层使用CSMA/CA协议 BBS：基本服务集，无线局域网的最小构件 SSID：服务集标识符，指的是使用该AP的无线局域网的名字
2.  无固定基础设施移动自组织网络

#### IEEE802.11局域网的MAC帧

![802.11局域网数据帧.png](802.11%E5%B1%80%E5%9F%9F%E7%BD%91%E6%95%B0%E6%8D%AE%E5%B8%A7.png)

**在两个AP之间传输时，RA和TA为AP地址**

![802.11mac帧头格式.png](802.11mac%E5%B8%A7%E5%A4%B4%E6%A0%BC%E5%BC%8F.png)

#### VLAN

通过虚拟局域网（Virtual LAN，VLAN），可以把一个较大的局域网分割成一些小的与地理位置无关的逻辑上的VLAN，而每个VLAN是一个较小的**广播域** 交换机上生成的各VLAN之间互不相通，若要通信，需借助**路由器或三层交换机**

![802.1q帧.png](802.1q%E5%B8%A7.png)

> 交换机之间传送数据帧时，会将MAC帧插入4字节的VLAN标记，前两个字节表明是IEEE802.1Q帧，中间4位没用，最后1**2位是VLAN标识符VID** VID的12取值可以为0～4095，但是**VID的取值为1～4094**（非全0或者全1）

## 广域网

**广域网的子网采用分组交换技术** 覆盖范围很广的长距离网络

**广域网与局域网的不同点**

广域网

局域网

覆盖范围

很广，通常跨时区

较小

连接方式

结点之间都是**点到点**连接，但是为了提高网络可靠性，一个结点交换机通常与多个结点交换机相连

普遍采用**多点接入**技术

OSI参考模型层次

三层：物理层、数据链路层、网络层

两层：物理层、数据链路层

着重点

资源共享

数据传输

**广域网与局域网的联系和相似点**：

1.  广域网和局域网都是互联网的重要组成构件，从互联网角度看，二者平等
2.  连接到一个广域网或一个局域网上的主机在该网内进行通信时，只需要使用其网络的物理地址

### PPP协议（**只支持全双工链路**）（**面向字节**）

PPP协议要求：

1.  简单
2.  封装成帧
3.  透明传输（异步路线：字节填充；同步路线：比特填充）
4.  多种网络层协议
5.  多种类型链路
6.  差错检测
7.  检测连接状态
8.  最大传送单元MTU
9.  网络层地址协商
10.  数据压缩协商

PPP协议的三个组成部分：

1.  链路控制协议（LCP），一种拓展链路控制协议（**身份验证**），用于建立、配置、测试和管理数据链路
2.  网络控制协议（NCP），PPP协议允许同时采用多种网络层协议，每个不同的网络层协议要用一个相应的NCP来配置，为网络层协议建立和配置逻辑连接
3.  将IP数据报封装到串行（同步/异步串行）

PPP协议无需满足的要求：

1.  纠错
2.  流量控制
3.  序号
4.  不支持多点线路

![ppp协议帧格式.png](ppp%E5%8D%8F%E8%AE%AE%E5%B8%A7%E6%A0%BC%E5%BC%8F.png)

### \*HDLC协议（**只支持全双工链路**）（**面向比特**）

HDLC：高级数据链路控制 透明传输：0比特插入法 HDLC的站：主站，从站，复合站 3种数据操作方式：

1.  正常相应方式
2.  异步平衡方式
3.  异步相应方式

![hdlc帧格式.png](hdlc%E5%B8%A7%E6%A0%BC%E5%BC%8F.png)

### PPP协议与HDLC协议的异同

相同：

1.  只支持全双工链路
2.  透明传输（PPP协议支持异步的字节填充和同步的比特填充，HDLC只支持比特填充）
3.  都有差错检测但是不纠正差错

不同点：

1.  **PPP协议**是**面向字节**的，**HDLC**是**面向比特**的
2.  PPP协议比HDLC多一个2字节的协议字段
3.  **PPP协议不使用序号和确认机制**，**HDLC协议使用了编号和确认机制，能提供可靠传输**

## 数据链路层设备

### 网桥

网桥工作在数据链路层的MAC子层，使得隔离碰撞域（冲突域）

网桥的优点：

1.  过滤通信量，增大吞吐量
2.  扩大了物理范围
3.  提高了可靠性
4.  互联不同物理层、不同MAC子层、和不同速率的以太网

### 交换机

多借口网桥

交换机的两种模式：

1.  直通式交换机 帧接收后立马传送出去 **优点**：速度快 **缺点**：缺乏安全性，也不支持不同速率的端口的交换
2.  存储转发式交换机 确认无误后通过查找表转换输出端口将该帧发送出去 **优点**：可靠性高，并能支持不同速率的端口间的转换 **缺点**：延迟较大

结点交换机：在广域网中，结点之间都是点到点连接，但为了提高网络可靠性，通常一个结点交换机与多个结点交换机相连 ^nodeswitch

* * *

**关于冲突域和广播域**

设备

所属层次

能否隔离冲突域

能否隔离广播域

集线器

物理层

不能

不能

中继器

物理层

不能

不能

交换机

数据链路层

能

不能

网桥

数据链路层

能

不能

路由器

网络层

能

能